<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSU-IIT CS Faculty Research Dashboard</title>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="css/style.css">

</head>
<body>

<!-- Navigation -->
<div id="navContainer"></div>

<h1>CS Research Dashboard</h1>

<section id="stats">
  <h2>Yearly Research Statistics</h2>
  <div class="stats-grid">
    <div class="stat-card" onclick="location.href='internals.html'">
      <span id="internalCount">0</span><br>Internally Funded
    </div>
    <div class="stat-card" onclick="location.href='externals.html'">
      <span id="externalCount">0</span><br>Externally Funded
    </div>
    <div class="stat-card" onclick="location.href='publications.html'">
      <span id="pubCount">0</span><br>Publications
    </div>
    <div class="stat-card" onclick="location.href='conferences.html'">
      <span id="confCount">0</span><br>Conferences
    </div>
  </div>
</section>

<div class="main-grid">
  <div class="left-panel">
    <h2>Research Outputs by Year</h2>
    <canvas id="chartCombined"></canvas>
  </div>

  <div class="right-panel">
    <h2>Faculty Members</h2>
    <table id="facultyTable" class="display">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- JS Libraries Loader -->
<script src="js/libs.js"></script>
<!-- CSV Sources -->
<script src="js/sources.js"></script>
<!-- Utility scripts -->
<script src="js/scripts.js"></script>

<script>
$(document).ready(function() {
  // Load navigation
  $("#navContainer").load("nav.html");

  // Faculty table
  loadCSV(CSV_SOURCES.faculty, 'facultyTable');

  // Yearly stats + chart
  Papa.parse(CSV_SOURCES.yearly, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const rows = results.data;
      if (!rows.length) return;

      const sample = rows[0];
      const years = Object.keys(sample).filter(k => /^\d{4}$/.test(k));

      const map = {};
      rows.forEach(r => map[r["Category"]] = r);

      // Update stat cards
      $("#internalCount").text(map["Internally Funded"]?.["Total"] || 0);
      $("#externalCount").text(map["Externally Funded"]?.["Total"] || 0);
      $("#pubCount").text(map["Publications"]?.["Total"] || 0);
      $("#confCount").text(map["Conferences"]?.["Total"] || 0);

      // Chart
      const categories = ["Internally Funded","Externally Funded","Publications","Conferences"];
      const colors = ["#1f77b4","#ff7f0e","#2ca02c","#d62728"];
      const datasets = categories.map((cat,i)=>({
        label: cat,
        backgroundColor: colors[i],
        data: years.map(y=>parseInt(map[cat]?.[y]||0))
      }));

      new Chart(document.getElementById("chartCombined"), {
        type: "bar",
        data: { labels: years, datasets: datasets },
        options: {
          responsive: true,
          plugins: { legend: { position: "top" } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }
  });
});
</script>

</body>
</html>

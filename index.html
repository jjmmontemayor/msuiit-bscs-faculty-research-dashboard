<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Index â€“ Statistics & Faculty</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 20px; }
    .container { display: flex; gap: 20px; align-items: flex-start; }
    .chart-box { flex: 1; }
    .table-box { flex: 1; max-height: 90vh; overflow-y: auto; border: 1px solid #ddd; padding: 10px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
    th { background: #f0f0f0; position: sticky; top: 0; }
  </style>
</head>
<body>
  <h1>Department Summary & Faculty</h1>

  <div class="container">
    <!-- CHART SECTION -->
    <div class="chart-box">
      <canvas id="yearlyChart"></canvas>
    </div>

    <!-- FACULTY TABLE -->
    <div class="table-box">
      <h2>Faculty Members</h2>
      <table id="facultyTable"></table>
    </div>
  </div>

  <script>
    const yearlyCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR-jDPbQ-ZCkBK8_1igyWkHd3ynUPHh5l8eI6KmD-qhpu9ZeYTqYV11X7NQ82NbYyEwvSiTzGVD6-3L/pub?gid=0&single=true&output=csv";
    const facultyCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR-jDPbQ-ZCkBK8_1igyWkHd3ynUPHh5l8eI6KmD-qhpu9ZeYTqYV11X7NQ82NbYyEwvSiTzGVD6-3L/pub?gid=5470856&single=true&output=csv";

    async function parseCSV(url) {
      const response = await fetch(url);
      const text = await response.text();
      return text.split("\n").map(row => row.split(","));
    }

    async function loadYearly() {
      const rows = await parseCSV(yearlyCSV);
      const header = rows[0];
      const data = rows.slice(1);

      const labels = header.slice(2); // years

      const categoriesToShow = ["Internally Funded", "Externally Funded", "Publications", "Conferences"];

      const datasets = categoriesToShow.map((category, index) => {
        const row = data.find(r => r[0] === category);
        return {
          label: category,
          data: row.slice(2).map(Number),
          backgroundColor: `rgba(${50 + index * 50}, 99, 200, 0.7)`
        };
      });

      new Chart(document.getElementById('yearlyChart'), {
        type: 'bar',
        data: { labels, datasets },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' }
          },
          scales: { x: { stacked: false }, y: { beginAtZero: true } }
        }
      });
    }

    async function loadFaculty() {
      const rows = await parseCSV(facultyCSV);
      const table = document.getElementById("facultyTable");

      table.innerHTML = "";
      const thead = document.createElement("thead");
      const tbody = document.createElement("tbody");

      const headerRow = document.createElement("tr");
      rows[0].forEach(col => {
        const th = document.createElement("th");
        th.textContent = col;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      rows.slice(1).forEach(row => {
        const tr = document.createElement("tr");
        row.forEach(col => {
          const td = document.createElement("td");
          td.textContent = col;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
    }

    loadYearly();
    loadFaculty();
  </script>
</body>
</html>

<table id="conferencesTable" class="display" style="width:100%"></table>
<canvas id="chartConferences"></canvas>

<script>
const csvUrl = CSVS.conferences; // Pull from CSV object

Papa.parse(csvUrl, {
  download:true,
  header:true,
  skipEmptyLines:true,
  complete:function(results){
    const data = results.data;
    const headers = results.meta.fields;

    const thead = $('#conferencesTable thead tr');
    headers.forEach(h => thead.append(`<th>${h}</th>`));

    const tbody = $('#conferencesTable tbody');
    data.forEach(row=>{
      let tr='<tr>';
      headers.forEach(h=>tr+=`<td>${row[h]||''}</td>`);
      tr+='</tr>';
      tbody.append(tr);
    });

    $('#conferencesTable').DataTable({pageLength:10, order:[[0,'desc']]});

    // Chart per year
    const yearCounts = {};
    data.forEach(row => { if(row.Year) yearCounts[row.Year] = (yearCounts[row.Year]||0)+1; });
    const labels = Object.keys(yearCounts).sort((a,b)=>a-b);
    const chartData = labels.map(y=>yearCounts[y]);

    new Chart(document.getElementById('chartConferences'), {
      type:'bar',
      data:{labels:labels, datasets:[{label:'Projects per Year', data:chartData, backgroundColor:'rgba(75,192,192,0.6)'}]},
      options:{responsive:true, plugins:{legend:{display:false}, title:{display:true,text:'Internal Projects per Year'}}, scales:{y:{beginAtZero:true, precision:0}}}
    });
  }
});
</script>
